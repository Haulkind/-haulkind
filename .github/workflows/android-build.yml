name: Android Release APK (Customer)

on:
  workflow_dispatch:

  jobs:
    build:
        runs-on: ubuntu-latest
            defaults:
                  run:
                          working-directory: apps/customer
                              steps:
                                    - name: Checkout
                                            uses: actions/checkout@v4
                                                    with:
                                                              ref: release/mobile-wrapper

                                                                    - name: Setup Node
                                                                            uses: actions/setup-node@v4
                                                                                    with:
                                                                                              node-version: 20
                                                                                                        cache: npm
                                                                                                        
                                                                                                              - name: Setup Java 17
                                                                                                                      uses: actions/setup-java@v4
                                                                                                                              with:
                                                                                                                                        distribution: temurin
                                                                                                                                                  java-version: "17"
                                                                                                                                                  
                                                                                                                                                        - name: Install dependencies (repo root)
                                                                                                                                                                run: |
                                                                                                                                                                          cd ../..
                                                                                                                                                                                    npm ci || npm install
                                                                                                                                                                                    
                                                                                                                                                                                          - name: Install dependencies (apps/customer)
                                                                                                                                                                                                  run: npm install
                                                                                                                                                                                                  
                                                                                                                                                                                                        - name: Create index.tsx
                                                                                                                                                                                                                run: |
                                                                                                                                                                                                                          mkdir -p app
                                                                                                                                                                                                                                    cat > app/index.tsx << 'INDEXEOF'
                                                                                                                                                                                                                                              import React from 'react';
                                                                                                                                                                                                                                                        import { View, Text, TouchableOpacity, StyleSheet, SafeAreaView } from 'react-native';
                                                                                                                                                                                                                                                                  import { useRouter } from 'expo-router';
                                                                                                                                                                                                                                                                            import { useAuth } from '../lib/AuthContext';
                                                                                                                                                                                                                                                                                      export default function Index() {
                                                                                                                                                                                                                                                                                                  const router = useRouter();
                                                                                                                                                                                                                                                                                                              const { user, isLoading } = useAuth();
                                                                                                                                                                                                                                                                                                                          React.useEffect(() => {
                                                                                                                                                                                                                                                                                                                                        if (!isLoading && user) { router.replace('/home'); }
                                                                                                                                                                                                                                                                                                                                                    }, [user, isLoading]);
                                                                                                                                                                                                                                                                                                                                                                if (isLoading) {
                                                                                                                                                                                                                                                                                                                                                                              return (<SafeAreaView style={styles.container}><View style={styles.loadingContainer}><Text style={styles.loadingText}>Loading...</Text></View></SafeAreaView>);
                                                                                                                                                                                                                                                                                                                                                                                      
