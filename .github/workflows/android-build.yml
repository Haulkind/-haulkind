name: Android Release APK (Customer) - Fixed

on:
  workflow_dispatch:

  jobs:
    build:
        runs-on: ubuntu-latest
            defaults:
                  run:
                          working-directory: apps/customer

                              steps:
                                    - name: Checkout
                                            uses: actions/checkout@v4
                                                    with:
                                                              ref: release/mobile-wrapper

                                                                    - name: Setup Node
                                                                            uses: actions/setup-node@v4
                                                                                    with:
                                                                                              node-version: 20
                                                                                                        cache: npm
                                                                                                        
                                                                                                              - name: Setup Java 17
                                                                                                                      uses: actions/setup-java@v4
                                                                                                                              with:
                                                                                                                                        distribution: temurin
                                                                                                                                                  java-version: "17"ig.xml << 'EOF'
                                                                                                                                                            <?xml version="1.0" encoding="utf-8"?>
                                                                                                                                                                      <network-security-config>
                                                                                                                                                                                    <base-config cleartextTrafficPermitted="true">
                                                                                                                                                                                                      <trust-anchors>
                                                                                                                                                                                                                            <certificates src="system" />
                                                                                                                                                                                                                                              </trust-anchors>
                                                                                                                                                                                                                                                            </base-config>
                                                                                                                                                                                                                                                                      </netwo
                                                                                                                                                  
                                                                                                                                                        - name: Install dependencies (repo root)
                                                                                                                                                                run: |
                                                                                                                                                                          cd ../..
                                                                                                                                                                                    npm ci || npm install
                                                                                                                                                                                    
                                                                                                                                                                                          - name: Install dependencies (apps/customer)
                                                                                                                                                                                                  run: npm install
                                                                                                                                                                                                  
                                                                                                                                                                                                        - name: Apply crash fixes
                                                                                                                                                                                                                run: |
                                                                                                                                                                                                                          echo "=== Aplicando correcoes para prevenir crash ==="
                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                              cat > lib/ErrorBoundary.tsx << 'ERROREOF'
                                                                                                                                                                                                                                                        import React, { Component, ReactNode } from 'react'
                                                                                                                                                                                                                                                                  import { View, Text, StyleSheet, TouchableOpacity } from 'react-native'
                                                                                                                                                                                                                                                                            interface Props { children: ReactNode }
                                                                                                                                                                                                                                                                                      interface State { hasError: boolean; error: Error | null }
                                                                                                                                                                                                                                                                                                export class ErrorBoundary extends Component<Props, State> {
                                                                                                                                                                                                                                                                                                            constructor(props: Props) { super(props); this.state = { hasError: false, error: null } }
                                                                                                                                                                                                                                                                                                                        static getDerivedStateFromError(error: Error): State { return { hasError: true, error } }
                                                                                                                                                                                                                                                                                                                                    componentDidCatch(error: E
